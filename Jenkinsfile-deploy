pipeline{
   agent { node { label 'master' } }
   parameters {
       string(name: 'WF_PROCESS_INSTANCE_ID', defaultValue: '', description: 'Camunda Process Instance ID')
   } // End parameters
    stages {
        stage('Debug Info') {
            steps {
                script {
                    echo("Camunda Process Instance: $WF_PROCESS_INSTANCE_ID")
                } // End script
            } // End steps
        } // End stage
        stage('Create RFC') {steps {script {echo("dummy stage")}}}
        stage ('Deploy Phase 1'){
            parallel {
                stage ('Keystores'){steps {script {echo("dummy stage")}}}
                stage ('Aliases'){steps {script {echo("dummy stage")}}}
                stage ('Caches'){steps {script {echo("dummy stage")}}}
                stage ('Kvms'){steps {script {echo("dummy stage")}}}
                stage ('Shared Flow'){steps {script {echo("dummy stage")}}}
                stage ('Target Servers'){steps {script {echo("dummy stage")}}}
            } // end parallel
        } // end stage
        stage ('Deploy Phase 2'){
            parallel {
                stage ('References'){steps {script {echo("dummy stage")}}}
                stage ('Proxy'){steps {script {echo("dummy stage")}}}
            } // end parallel
        } // end stage
        stage ('Deploy Phase 3'){
            parallel {
                stage ('Developers'){steps {script {echo("dummy stage")}}}
                stage ('Flow Hooks'){steps {script {echo("dummy stage")}}}
                stage ('Products'){steps {script {echo("dummy stage")}}}
            } // end parallel
        } // end stage
        stage ('Deploy Phase 4'){
            parallel {
                stage ('Apps'){steps {script {echo("dummy stage")}}}
            } // end parallel
        } // end stage
    } // End stages
    post {
        always {
            script{
                // currentBuild.displayName = "#${_buildNumber} - ${_gitRepo} (${_gitRefName})"
                // currentBuild.description =  "(${_user}) ${_commitIdShort} | ${_triggeredBy} | ${_gitRepo} | ${_gitRefName} | ${_commitMsg}"
                currentBuild.displayName = "#${env.BUILD_NUMBER}"
                currentBuild.description =  "processInstanceId:${WF_PROCESS_INSTANCE_ID} currentBuildResult:${currentBuild.currentResult}"
            }
        }
        failure {
            script {
                echo("Simulation only")
            } // End script
        } // End failure
        success {
            script {
                echo("Simulation only")
            } // End script
        } // End success
        cleanup {deleteDir()}// Clean workspace
     } // End post
} // End pipeline
